// Generated by CoffeeScript 1.7.1
(function() {
  var app;

  $(document).ready(function() {
    app.init();
    return window.app = app;
  });

  app = {
    game: {
      shit_amount: 0,
      spc: 1,
      sps: 0,
      autoclick_interval: "",
      upgrades: {
        0: {
          name: "Powershit",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "Increase shit per click",
          level: 0,
          cost: 2500,
          sps: 0
        },
        1: {
          name: "Upgrade 1",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+0.2 Shit per second",
          level: 0,
          cost: 10,
          sps: 0.2
        },
        2: {
          name: "Upgrade 2",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+1 Shit per second",
          level: 0,
          cost: 45,
          sps: 1
        },
        3: {
          name: "Upgrade 3",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+3 Shit per second",
          level: 0,
          cost: 100,
          sps: 3
        },
        4: {
          name: "Upgrade 4",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+10 Shit per second",
          level: 0,
          cost: 800,
          sps: 10
        },
        5: {
          name: "Upgrade 5",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+30 Shit per second",
          level: 0,
          cost: 1500,
          sps: 30
        },
        6: {
          name: "Upgrade 6",
          desc: "Lorem Ipsum Dolor Sit Amet ...",
          effect: "+100 Shit per second",
          level: 0,
          cost: 5000,
          sps: 100
        }
      }
    },
    init: function() {
      this.bind_events();
      this.load_upgrades();
      return this.load_game();
    },
    bind_events: function() {
      $(document).on("click", ".btn-shit", function(e) {
        app.add_shit(app.game.spc);
        return app.show_amount_added(e, app.game.spc);
      });
      $(document).on("click", ".btn-upgrades", function(e) {
        return app.toggle_upgrades();
      });
      return $(document).on("click", ".btn-buy-upgrade", function(e) {
        return app.buy_upgrade($(this).data("upgrade"));
      });
    },
    save_game: function() {
      return localStorage["shitclick_savegame"] = btoa(JSON.stringify(this.game));
    },
    load_game: function() {
      var savegame;
      if (localStorage.shitclick_shit !== void 0) {
        savegame = JSON.parse(atob(localStorage["shitclick_savegame"]));
        this.game = savegame;
        clearInterval(this.game.autoclick_interval);
        this.autoclick_interval = setInterval((function() {
          return app.add_shit(app.game.sps);
        }), 1000);
        this.refresh_shit();
        return this.load_upgrades();
      }
    },
    toggle_upgrades: function() {
      $(".upgrades").stop();
      $(".btn-upgrades").toggleClass("entypo-plus").toggleClass("entypo-minus");
      if ($(".upgrades").data("open") === "no") {
        $(".upgrades").animate({
          top: "0%"
        });
        return $(".upgrades").data("open", "yes");
      } else {
        $(".upgrades").animate({
          top: "150%"
        });
        return $(".upgrades").data("open", "no");
      }
    },
    add_shit: function(amount) {
      this.game.shit_amount += amount;
      this.check_prices();
      this.refresh_shit();
      return this.save_game();
    },
    check_prices: function() {
      return $.each(this.game.upgrades, function(key, value) {
        if (app.game.shit_amount >= app.get_price(value)) {
          return $(".upgrade-" + key + " .btn-buy-upgrade").removeClass("disabled");
        } else {
          return $(".upgrade-" + key + " .btn-buy-upgrade").addClass("disabled");
        }
      });
    },
    get_price: function(upgrade) {
      var result;
      result = ((upgrade.level + 1) * upgrade.cost) * (upgrade.level + 1);
      if ((upgrade.level + 1) > 10) {
        result *= 2;
      }
      return result;
    },
    refresh_shit: function() {
      $(".shit-amount").html(Math.round(this.game.shit_amount * 10) / 10);
      return $(".sps").html(Math.round(this.game.sps * 10) / 10 + " Shit / Second");
    },
    show_amount_added: function(e, amount) {
      var info;
      info = $("<span class='amount-added-info'>+" + amount + "</span>");
      info.css("top", e.pageY - 50 + "px");
      info.css("left", e.pageX + "px");
      $("body").append(info);
      return info.animate({
        top: "-=100px",
        opacity: 0
      }, 500, function() {
        return $(this).remove();
      });
    },
    buy_upgrade: function(upgrade) {
      if (this.game.shit_amount >= this.get_price(this.game.upgrades[upgrade])) {
        this.game.shit_amount -= this.get_price(this.game.upgrades[upgrade]);
        this.game.upgrades[upgrade].level++;
        this.load_upgrades();
        this.check_prices();
        this.refresh_shit();
        this.save_game();
        return this.use_upgrade(upgrade);
      }
    },
    use_upgrade: function(upgrade) {
      switch (upgrade) {
        case 0:
          this.game.spc = this.game.spc + (this.game.spc / 2);
          break;
        default:
          this.game.sps += this.game.upgrades[upgrade].sps;
          clearInterval(this.game.autoclick_interval);
          this.autoclick_interval = setInterval((function() {
            return app.add_shit(app.game.sps);
          }), 1000);
      }
      return this.refresh_shit();
    },
    load_upgrades: function() {
      $(".upgrades").html("");
      $.each(this.game.upgrades, function(key, value) {
        return $(".upgrades").append("<div class='upgrade upgrade-" + key + "' data-upgrade='" + key + "'>" + "<h3>" + value.name + "<span>" + value.level + "</span></h3>" + "<p class='info'><strong>" + app.get_price(value) + "</strong> â€” " + value.desc + "</p>" + "<div class='btn-buy-upgrade' data-upgrade='" + key + "'>Buy</div>" + "<div class='btn-sell-upgrade' data-upgrade='" + key + "'>Sell</div>" + "<p class='effect'>" + value.effect + "</p>" + "</div>");
      });
      return this.check_prices();
    }
  };

}).call(this);
